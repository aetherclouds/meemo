import{S as Le,i as Ce,s as Ne,e as b,b as d,y as le,d as C,t as W,o as me,g as ee,f as pe,h as N,z as je,a as D,m as q,c as g,l as Z,A as Ze,q as ke,u as be,w as _e,j as ve,r as ze,n as he,B as xe,C as de,p as Te,x as fe,v as Je,D as Ee,E as De,F as He,G as $e,H as et,I as Re,J as tt}from"./svelteTransition.js";import{E as we,e as ye,R as ce,b as nt,D as Ie,g as lt}from"./const.js";import{g as ot,b as st,A as Se,c as it,d as rt,e as at}from"./ankiConnectUtil.js";function Pe(n,e,t){const s=n.slice();return s[44]=e[t][0],s[45]=e[t][1],s[46]=e,s[47]=t,s}function Ae(n,e,t){const s=n.slice();return s[48]=e[t],s}function Oe(n,e,t){const s=n.slice();return s[51]=e[t],s}function Ue(n){let e,t,s,o,l,i,a,f,u,r,h,p,H,T,M,y,B,X,S,w,K,A,k,x,G,oe,ae,te,ue,V,v,R,j,O,U,se,ie,z=n[12]&&Fe(n),I=n[0]!=null&&Xe(n),$=n[9],P=[];for(let _=0;_<$.length;_+=1)P[_]=Ye(Oe(n,$,_));let ne=n[10],E=[];for(let _=0;_<ne.length;_+=1)E[_]=qe(Ae(n,ne,_));let J=Object.entries(n[11]),F=[];for(let _=0;_<J.length;_+=1)F[_]=Ge(Pe(n,J,_));return{c(){e=b("div"),t=b("div"),t.innerHTML=`<div class="grid grid-rows-2 grid-cols-4 mx-auto w-max justify-center gap-x-1 gap-y-1 my-auto svelte-mdhxpg"><div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div> 
                <div class="bg-zinc-500 rounded-full aspect-square w-[0.16rem] h-[0.16rem] svelte-mdhxpg"></div></div>`,s=D(),o=b("div"),l=b("h1"),l.textContent="Add2Anki",i=D(),z&&z.c(),a=D(),I&&I.c(),f=D(),u=b("form"),r=b("div"),h=b("div"),p=b("label"),p.textContent="Card Deck",H=D(),T=b("div"),M=b("select");for(let _=0;_<P.length;_+=1)P[_].c();y=D(),B=b("select"),X=D(),S=b("div"),w=b("label"),w.textContent="Card Model",K=D(),A=b("div"),k=b("select");for(let _=0;_<E.length;_+=1)E[_].c();x=D(),G=b("select"),oe=D();for(let _=0;_<F.length;_+=1)F[_].c();ae=D(),te=b("div"),te.textContent=" ",ue=D(),V=b("button"),v=q("Add that thing!"),d(t,"draggable",""),d(t,"class","w-full h-min py-1.5 rounded-[0.3rem] box-border flex cursor-move hover:bg-zinc-500/20 transition-colors duration-100  svelte-mdhxpg"),d(l,"class","text-blue-gradient font-bold text-xl mx-auto mb-5 svelte-mdhxpg"),d(p,"for","deckName"),d(p,"class","block mb-0.5 label-on-focus svelte-mdhxpg"),d(M,"name","deckName"),d(M,"id","deckName"),d(M,"class","w-full rounded-[0.3rem] bg-zinc-500/20 border border-zinc-600 truncate outline-none hover:border-zinc-400 focus:border-blue-400 transition-colors duration-100 svelte-mdhxpg"),B.disabled=!0,d(B,"class","absolute w-full h-full top-0 left-0 bg-transparent border border-transparent text-zinc-500 pointer-events-none svelte-mdhxpg"),d(T,"class","relative svelte-mdhxpg"),d(h,"class","pr-2 svelte-mdhxpg"),d(w,"for","modelName"),d(w,"class","block mb-0.5 svelte-mdhxpg"),d(k,"name","modelName"),d(k,"id","modelName"),d(k,"class","w-full rounded-[0.3rem] bg-zinc-500/20 border border-zinc-600 truncate outline-none hover:border-zinc-400 focus:border-blue-400 transition-colors duration-100 svelte-mdhxpg"),G.disabled=!0,d(G,"class","absolute w-full h-full top-0 left-0 bg-transparent border border-transparent text-zinc-500 pointer-events-none svelte-mdhxpg"),d(A,"class","relative svelte-mdhxpg"),d(S,"class","pl-2 svelte-mdhxpg"),d(r,"class","w-full grid grid-cols-2 mb-3 svelte-mdhxpg"),d(te,"class","opacity-0 block mb-0.5 svelte-mdhxpg"),d(V,"type","submit"),d(V,"class","w-full rounded-[0.3rem] bg-zinc-500/20 border border-zinc-600 text-sm py-1 appearance-none outline-none enabled:hover:border-blue-400 enabled:hover:text-blue-400 focus:border-blue-400 focus:text-blue-400 shadow-none focus:shadow-inner disabled:opacity-80 disabled-border-zinc-600 transition-colors duration-100 svelte-mdhxpg"),V.disabled=R=!n[13]||void 0,d(u,"action",""),d(u,"class","text-zinc-300 text-sm svelte-mdhxpg"),d(u,"id","leForm"),d(o,"class","p-5 flex flex-col max-h-xs overflow-auto bg-transparent svelte-mdhxpg"),d(e,"class",j="bg-zinc-800/90 w-[20rem] max-w-[20rem] rounded-[0.3rem] blur-bg relative border "+(n[3]?"shadow-xl shadow-black/10":"shadow-sm ")+" "+(n[12]?n[12]!="success"&&!n[15]?"border-red-400":"border-green-400":n[15]?"border-green-400":"border-transparent")+" "+(n[14]?" ring-1 ring-blue-400 ":"")+" duration-100 svelte-mdhxpg"),le(e,"transition-property","box-shadow, border-color")},m(_,m){C(_,e,m),g(e,t),g(e,s),g(e,o),g(o,l),g(o,i),z&&z.m(o,null),g(o,a),I&&I.m(o,null),g(o,f),g(o,u),g(u,r),g(r,h),g(h,p),g(h,H),g(h,T),g(T,M);for(let c=0;c<P.length;c+=1)P[c]&&P[c].m(M,null);n[29](M),g(T,y),g(T,B),g(r,X),g(r,S),g(S,w),g(S,K),g(S,A),g(A,k);for(let c=0;c<E.length;c+=1)E[c]&&E[c].m(k,null);n[30](k),g(A,x),g(A,G),g(u,oe);for(let c=0;c<F.length;c+=1)F[c]&&F[c].m(u,null);g(u,ae),g(u,te),g(u,ue),g(u,V),g(V,v),U=!0,se||(ie=[Z(t,"mousedown",n[18]),Z(t,"mouseup",n[19]),Z(M,"change",n[20]),Z(k,"change",n[21]),Z(u,"submit",Ze(n[17]))],se=!0)},p(_,m){if(n=_,n[12]?z?(z.p(n,m),m[0]&4096&&W(z,1)):(z=Fe(n),z.c(),W(z,1),z.m(o,a)):z&&(me(),ee(z,1,1,()=>{z=null}),pe()),n[0]!=null?I?I.p(n,m):(I=Xe(n),I.c(),I.m(o,f)):I&&(I.d(1),I=null),m[0]&576){$=n[9];let c;for(c=0;c<$.length;c+=1){const L=Oe(n,$,c);P[c]?P[c].p(L,m):(P[c]=Ye(L),P[c].c(),P[c].m(M,null))}for(;c<P.length;c+=1)P[c].d(1);P.length=$.length}if(m[0]&1280){ne=n[10];let c;for(c=0;c<ne.length;c+=1){const L=Ae(n,ne,c);E[c]?E[c].p(L,m):(E[c]=qe(L),E[c].c(),E[c].m(k,null))}for(;c<E.length;c+=1)E[c].d(1);E.length=ne.length}if(m[0]&4196352){J=Object.entries(n[11]);let c;for(c=0;c<J.length;c+=1){const L=Pe(n,J,c);F[c]?F[c].p(L,m):(F[c]=Ge(L),F[c].c(),F[c].m(u,ae))}for(;c<F.length;c+=1)F[c].d(1);F.length=J.length}(!U||m[0]&8192&&R!==(R=!n[13]||void 0))&&(V.disabled=R),(!U||m[0]&53256&&j!==(j="bg-zinc-800/90 w-[20rem] max-w-[20rem] rounded-[0.3rem] blur-bg relative border "+(n[3]?"shadow-xl shadow-black/10":"shadow-sm ")+" "+(n[12]?n[12]!="success"&&!n[15]?"border-red-400":"border-green-400":n[15]?"border-green-400":"border-transparent")+" "+(n[14]?" ring-1 ring-blue-400 ":"")+" duration-100 svelte-mdhxpg"))&&d(e,"class",j)},i(_){U||(W(z),ke(()=>{U&&(O||(O=be(e,_e,{axis:"y",duration:n[1].useMotion.value?Me:0},!0)),O.run(1))}),U=!0)},o(_){ee(z),O||(O=be(e,_e,{axis:"y",duration:n[1].useMotion.value?Me:0},!1)),O.run(0),U=!1},d(_){_&&N(e),z&&z.d(),I&&I.d(),ve(P,_),n[29](null),ve(E,_),n[30](null),ve(F,_),_&&O&&O.end(),se=!1,ze(ie)}}}function Fe(n){let e,t,s,o,l,i;function a(h,p){if(h[12]=="connection")return ft;if(h[12]=="response")return dt;if(h[12]=="unknown")return ct;if(h[12]=="success")return ut}let f=a(n),u=f&&f(n),r=n[12]=="connection"&&Be(n);return{c(){e=b("div"),t=b("div"),u&&u.c(),s=D(),r&&r.c(),d(t,"class","svelte-mdhxpg"),d(e,"class",o="rounded-[0.3rem] border "+(n[12]=="success"?"border-green-400":"border-red-400")+" text-zinc-300 px-2 py-1 mb-3 flex flex-col h-max text-xs hyphens-auto svelte-mdhxpg"),le(e,"transition","border-color 500ms, height 500ms")},m(h,p){C(h,e,p),g(e,t),u&&u.m(t,null),g(e,s),r&&r.m(e,null),i=!0},p(h,p){n=h,f!==(f=a(n))&&(u&&u.d(1),u=f&&f(n),u&&(u.c(),u.m(t,null))),n[12]=="connection"?r?r.p(n,p):(r=Be(n),r.c(),r.m(e,null)):r&&(r.d(1),r=null),(!i||p[0]&4096&&o!==(o="rounded-[0.3rem] border "+(n[12]=="success"?"border-green-400":"border-red-400")+" text-zinc-300 px-2 py-1 mb-3 flex flex-col h-max text-xs hyphens-auto svelte-mdhxpg"))&&d(e,"class",o)},i(h){i||(ke(()=>{i&&(l||(l=be(e,_e,{axis:"y",duration:n[1].useMotion.value?500:0},!0)),l.run(1))}),i=!0)},o(h){l||(l=be(e,_e,{axis:"y",duration:n[1].useMotion.value?500:0},!1)),l.run(0),i=!1},d(h){h&&N(e),u&&u.d(),r&&r.d(),h&&l&&l.end()}}}function ut(n){let e;return{c(){e=q("Successfully reconnected with Anki!")},m(t,s){C(t,e,s)},d(t){t&&N(e)}}}function ct(n){let e;return{c(){e=q("There has been an uknown error. ¯\\_(ツ)_/¯")},m(t,s){C(t,e,s)},d(t){t&&N(e)}}}function dt(n){let e;return{c(){e=q("There has been a response error. AnkiConnect is running but did not respond properly.")},m(t,s){C(t,e,s)},d(t){t&&N(e)}}}function ft(n){let e,t,s;return{c(){e=q("There has been a connection error. Make sure that Anki is open, and that "),t=b("a"),t.textContent="AnkiConnect",s=q(" is installed & running."),d(t,"class","text-blue-400 underline svelte-mdhxpg"),d(t,"href","https://ankiweb.net/shared/info/2055492159"),d(t,"target","_blank")},m(o,l){C(o,e,l),C(o,t,l),C(o,s,l)},d(o){o&&N(e),o&&N(t),o&&N(s)}}}function Be(n){let e,t,s,o;return{c(){e=b("div"),t=q("retrying in "),s=q(n[16]),o=q(" second(s) . . ."),d(e,"class","block text-[0.5rem] text-zinc-400 svelte-mdhxpg")},m(l,i){C(l,e,i),g(e,t),g(e,s),g(e,o)},p(l,i){i[0]&65536&&he(s,l[16])},d(l){l&&N(e)}}}function Xe(n){let e,t,s,o,l,i,a,f;return{c(){e=b("div"),t=b("span"),t.textContent=`${ce}`,s=D(),o=b("span"),o.textContent=" → ",l=D(),i=b("span"),d(t,"class","replaceable svelte-mdhxpg"),d(o,"class","svelte-mdhxpg"),d(i,"contenteditable",""),d(i,"class","break-all text-zinc-300 rounded hover:bg-zinc-500/20 border-transparent hover:border-zinc-400 outline-none focus:border-blue-400 focus:bg-zinc-500/20 transition-colors duration-100 border px-1 svelte-mdhxpg"),le(i,"min-width","10px"),n[0]===void 0&&ke(()=>n[27].call(i)),d(e,"class","text-xs text-zinc-400 mb-3 mx-auto flex items-center svelte-mdhxpg")},m(u,r){C(u,e,r),g(e,t),g(e,s),g(e,o),g(e,l),g(e,i),n[0]!==void 0&&(i.innerHTML=n[0]),a||(f=[Z(i,"input",n[27]),Z(i,"input",n[28])],a=!0)},p(u,r){r[0]&1&&u[0]!==i.innerHTML&&(i.innerHTML=u[0])},d(u){u&&N(e),a=!1,ze(f)}}}function Ye(n){let e,t=n[51]+"",s,o,l;return{c(){e=b("option"),s=q(t),e.__value=o=n[51],e.value=e.__value,d(e,"class","bg-zinc-800 svelte-mdhxpg"),e.selected=l=n[51]==n[6]||null},m(i,a){C(i,e,a),g(e,s)},p(i,a){a[0]&512&&t!==(t=i[51]+"")&&he(s,t),a[0]&512&&o!==(o=i[51])&&(e.__value=o,e.value=e.__value),a[0]&576&&l!==(l=i[51]==i[6]||null)&&(e.selected=l)},d(i){i&&N(e)}}}function qe(n){let e,t=n[48]+"",s,o,l;return{c(){e=b("option"),s=q(t),e.__value=o=n[48],e.value=e.__value,d(e,"class","bg-zinc-800 svelte-mdhxpg"),e.selected=l=n[48]==n[8]||null},m(i,a){C(i,e,a),g(e,s)},p(i,a){a[0]&1024&&t!==(t=i[48]+"")&&he(s,t),a[0]&1024&&o!==(o=i[48])&&(e.__value=o,e.value=e.__value),a[0]&1280&&l!==(l=i[48]==i[8]||null)&&(e.selected=l)},d(i){i&&N(e)}}}function We(n){let e;return{c(){e=q("This field will stay saved")},m(t,s){C(t,e,s)},d(t){t&&N(e)}}}function Ge(n){let e,t,s=n[44]+"",o,l,i,a,f,u,r,h,p,H,T,M,y,B,X,S,w=n[45].shouldSave&&We();function K(){n[31].call(r,n[46],n[47])}function A(){n[32].call(T,n[46],n[47])}return{c(){e=b("div"),t=b("label"),o=q(s),i=D(),a=b("small"),w&&w.c(),f=D(),u=b("div"),r=b("textarea"),H=D(),T=b("div"),d(t,"for",l="field-"+n[44]),d(t,"class","mr-2 svelte-mdhxpg"),d(a,"class","text-[0.6rem] text-zinc-400 svelte-mdhxpg"),d(e,"class","flex align-middle mb-0.5 items-center svelte-mdhxpg"),d(r,"rows","1"),d(r,"id",h="field-"+n[44]),d(r,"data-fieldname",p=n[44]),d(r,"class","peer bg-transparent w-full overflow-hidden resize-none break-all relative top-0 left-0 webkit-text-transparent px-1 border border-transparent appearance-none outline-none rounded-[0.3rem] svelte-mdhxpg"),d(T,"id",M="field-display-"+n[44]),d(T,"contenteditable","true"),d(T,"class","absolute size-inherit break-all top-0 left-0 bg-zinc-500/20 pointer-events-none overflow-clip px-1 border border-transparent hyphens-auto peer-hover:border-zinc-400 border-zinc-600 rounded-[0.3rem] peer-focus:border-blue-400 transition-colors duration-100 svelte-mdhxpg"),n[45].displayHTML===void 0&&ke(A),d(u,"class","relative w-full rounded mb-3 svelte-mdhxpg"),d(u,"data-fieldname",y=n[44]),d(u,"id",B=n[44])},m(k,x){C(k,e,x),g(e,t),g(t,o),g(e,i),g(e,a),w&&w.m(a,null),C(k,f,x),C(k,u,x),g(u,r),xe(r,n[45].value),g(u,H),g(u,T),n[45].displayHTML!==void 0&&(T.innerHTML=n[45].displayHTML),X||(S=[Z(r,"input",n[22]),Z(r,"input",K),Z(T,"input",A)],X=!0)},p(k,x){n=k,x[0]&2048&&s!==(s=n[44]+"")&&he(o,s),x[0]&2048&&l!==(l="field-"+n[44])&&d(t,"for",l),n[45].shouldSave?w||(w=We(),w.c(),w.m(a,null)):w&&(w.d(1),w=null),x[0]&2048&&h!==(h="field-"+n[44])&&d(r,"id",h),x[0]&2048&&p!==(p=n[44])&&d(r,"data-fieldname",p),x[0]&2048&&xe(r,n[45].value),x[0]&2048&&M!==(M="field-display-"+n[44])&&d(T,"id",M),x[0]&2048&&n[45].displayHTML!==T.innerHTML&&(T.innerHTML=n[45].displayHTML),x[0]&2048&&y!==(y=n[44])&&d(u,"data-fieldname",y),x[0]&2048&&B!==(B=n[44])&&d(u,"id",B)},d(k){k&&N(e),w&&w.d(),k&&N(f),k&&N(u),X=!1,ze(S)}}}function mt(n){let e,t,s,o=n[4]&&Ue(n);return{c(){e=b("dialog"),o&&o.c(),e.open=!0,d(e,"class",t=(n[1].shouldPopupBePinned.value?"fixed":"absolute")+" p-0 m-0 bg-transparent popup svelte-mdhxpg"),le(e,"--UIScale",n[1].UIScale.value)},m(l,i){C(l,e,i),o&&o.m(e,null),n[33](e),s=!0},p(l,i){l[4]?o?(o.p(l,i),i[0]&16&&W(o,1)):(o=Ue(l),o.c(),W(o,1),o.m(e,null)):o&&(me(),ee(o,1,1,()=>{o=null}),pe()),(!s||i[0]&2&&t!==(t=(l[1].shouldPopupBePinned.value?"fixed":"absolute")+" p-0 m-0 bg-transparent popup svelte-mdhxpg"))&&d(e,"class",t),(!s||i[0]&2)&&le(e,"--UIScale",l[1].UIScale.value)},i(l){s||(W(o),s=!0)},o(l){ee(o),s=!1},d(l){l&&N(e),o&&o.d(),n[33](null)}}}const Me=300;function pt(n,e){chrome.storage.sync.set({selectedDeck:n,selectedModel:e})}function ht(n){let e=Object.keys(n).reduce((t,s)=>(n[s].shouldSave&&(t[s]=n[s].value),t),{});Object.keys(e).length<=0?chrome.storage.sync.remove("savedFields"):chrome.storage.sync.set({savedFields:e})}function gt(n,e,t){let{staticHoverNode:s}=e,{parentDocument:o=document}=e,{options:l}=e,{contentToSave:i=void 0}=e,{initialX:a=0}=e,{initialY:f=0}=e,u,r=!1,h=!1,p,H,T,M,y,B=[],X=[],S={},w="",K=!1,A=!1,k=!1;je(()=>{t(2,u.style.left=a+"px",u),t(2,u.style.top=f+"px",u),t(4,h=!0),x(),o.addEventListener("mouseup",j)});async function x(m=!0){try{const c=await ot(),L=await st();if(c&&L)t(9,B=c),t(10,X=L),t(13,K=!0),X.length>1&&ie(X[0]),m?t(12,w=""):(t(12,w="success"),setTimeout(()=>{t(12,w="")},5e3)),t(6,H=(await browserStorageSync.get("selectedDeck")).selectedDeck),t(8,M=(await browserStorageSync.get("selectedModel")).selectedModel),y=(await browserStorageSync.get("savedFields")).savedFields||{};else throw new Se}catch(c){oe(c,()=>x(!1))}}let G=0;function oe(m,c){switch(console.error(we+" :",m),m.constructor){case it:t(12,w="connection");break;case Se:t(12,w="response");break;default:t(12,w="unknown");break}if(c){t(16,G=5);let L=setInterval(()=>{t(16,G-=1),G==0&&h&&(c(),clearInterval(L))},1e3)}}async function ae(m){const c=new FormData(m.target),L=Object.keys(S).reduce((Q,re)=>(Q[re]=S[re].value,Q),{}),Y=Object.keys(L).reduce((Q,re)=>(Q[re]=L[re].replaceAll("$replace$",i),Q),{});t(13,K=!1);let ge;try{ge=await at(c.get("deckName"),c.get("modelName"),Y)}catch(Q){t(12,w="response"),setTimeout(()=>{t(12,w="")},5e3)}ge?(t(15,k=!0),setTimeout(()=>{t(15,k=!1)},5e3),pt(c.get("deckName"),c.get("modelName")),ht(S)):oe(new Se),t(13,K=!0)}let te,ue;function V(m){const c=u.getBoundingClientRect();te=-m.clientX+c.left,ue=-m.clientY+c.top,o.addEventListener("mousemove",R),o.addEventListener("mouseup",v),t(3,r=!0),t(14,A=!1),t(15,k=!1)}function v(m){t(3,r=!1),o.removeEventListener("mousemove",R),o.removeEventListener("mouseup",v)}function R(m){m.preventDefault(),t(2,u.style.left=(l.shouldPopupBePinned.value?m.clientX:m.pageX)+te+"px",u),t(2,u.style.top=(l.shouldPopupBePinned.value?m.clientY:m.pageY)+ue+"px",u)}function j(m){m.target.id!=we+"-root"?A?O():t(14,A=!0):t(14,A=!1)}function O(){t(4,h=!1),o.removeEventListener("mouseup",j),setTimeout(()=>{u.parentNode.removeChild(u)},Me)}async function U(m){t(6,H=m.target.value)}async function se(m){t(8,M=m.target.value),ie(m.target.value)}async function ie(m){const c=await rt(m);t(11,S=c.reduce((L,Y)=>y[Y]?(L[Y]={value:y[Y],shouldSave:!0,displayHTML:z(y[Y])},L):(L[Y]={value:"",shouldSave:!1,displayHTML:""},L),{}))}function z(m){const c=ye(m),L=m.indexOf(ce);let Y;return L!=-1&&(Y=c.replaceAll(ce,`<span class="replaceable">${ce}</span>`)),Y}function I(m){const c=m.target.dataset.fieldname,L=m.target.value,Y=ye(L);t(11,S[c].value=Y,S);const ge=Y.indexOf(ce);let Q;ge!=-1?(Q=Y.replaceAll(ce,`<span class="replaceable">${ce}</span>`),t(11,S[c].shouldSave=!0,S)):(Q=Y,t(11,S[c].shouldSave=!1,S)),m.target.nextElementSibling.innerHTML=Q,t(11,S[c].displayHTML=Q,S);const re=m.target.nextElementSibling.getBoundingClientRect();m.target.style.height=re.height/l.UIScale.value+"px",m.target.style.width=re.width/l.UIScale.value+"px"}function $(){i=this.innerHTML,t(0,i)}const P=m=>{let c=m.target.innerHTML;c=ye(c)};function ne(m){de[m?"unshift":"push"](()=>{T=m,t(7,T),t(9,B)})}function E(m){de[m?"unshift":"push"](()=>{p=m,t(5,p),t(10,X)})}function J(m,c){m[c][1].value=this.value,t(11,S)}function F(m,c){m[c][1].displayHTML=this.innerHTML,t(11,S)}function _(m){de[m?"unshift":"push"](()=>{u=m,t(2,u)})}return n.$$set=m=>{"staticHoverNode"in m&&t(23,s=m.staticHoverNode),"parentDocument"in m&&t(24,o=m.parentDocument),"options"in m&&t(1,l=m.options),"contentToSave"in m&&t(0,i=m.contentToSave),"initialX"in m&&t(25,a=m.initialX),"initialY"in m&&t(26,f=m.initialY)},[i,l,u,r,h,p,H,T,M,B,X,S,w,K,A,k,G,ae,V,v,U,se,I,s,o,a,f,$,P,ne,E,J,F,_]}class Qe extends Le{constructor(e){super(),Ce(this,e,gt,mt,Ne,{staticHoverNode:23,parentDocument:24,options:1,contentToSave:0,initialX:25,initialY:26},null,[-1,-1])}}function vt(n){let e,t,s,o,l;return{c(){e=b("div"),t=b("img"),Te(t.src,s=chrome.runtime.getURL("assets/icons/anki.png"))||d(t,"src",s),d(t,"alt","Save 2 Anki"),d(t,"class","icon svelte-14zaszm"),d(e,"class","panel svelte-14zaszm")},m(i,a){C(i,e,a),g(e,t),n[7](e),o||(l=Z(e,"click",n[1]),o=!0)},p:fe,i:fe,o:fe,d(i){i&&N(e),n[7](null),o=!1,l()}}}function bt(n,e,t){let{staticHoverNode:s}=e,{parentDocument:o}=e,{selectionText:l}=e,{hideToolbar:i}=e,{options:a}=e,f;function u(){const p=f.getBoundingClientRect();new Qe({target:s,props:{parentDocument:o,staticHoverNode:s,initialX:p.left+(a.shouldPopupBePinned.value?0:document.documentElement.scrollLeft||document.body.scrollLeft),initialY:p.top+(a.shouldPopupBePinned.value?0:document.documentElement.scrollTop||document.body.scrollTop),contentToSave:l,options:a}})}function r(){u(),i()}function h(p){de[p?"unshift":"push"](()=>{f=p,t(0,f)})}return n.$$set=p=>{"staticHoverNode"in p&&t(2,s=p.staticHoverNode),"parentDocument"in p&&t(3,o=p.parentDocument),"selectionText"in p&&t(4,l=p.selectionText),"hideToolbar"in p&&t(5,i=p.hideToolbar),"options"in p&&t(6,a=p.options)},[f,r,s,o,l,i,a,h]}class _t extends Le{constructor(e){super(),Ce(this,e,bt,vt,Ne,{staticHoverNode:2,parentDocument:3,selectionText:4,hideToolbar:5,options:6})}}function Ke(n,e,t){const s=n.slice();return s[30]=e[t],s}function wt(n){let e,t,s,o,l,i,a=n[30].wordForGender+"",f,u,r;return{c(){e=b("div"),t=b("img"),l=D(),i=b("div"),f=q(a),u=D(),Te(t.src,s=n[30].flagURL)||d(t,"src",s),d(t,"class","block mr-1 rounded-[3px] svelte-wlg48u"),d(t,"alt",o=n[30].countryCode+" flag"),d(i,"class","opacity-90 svelte-wlg48u"),d(e,"class",r="blurry-bg "+n[30].gender+"-entry flex pointer-events-none px-1 w-full items-center text-center text-sm font-bold svelte-wlg48u")},m(h,p){C(h,e,p),g(e,t),g(e,l),g(e,i),g(i,f),g(e,u)},p(h,p){p[0]&32&&!Te(t.src,s=h[30].flagURL)&&d(t,"src",s),p[0]&32&&o!==(o=h[30].countryCode+" flag")&&d(t,"alt",o),p[0]&32&&a!==(a=h[30].wordForGender+"")&&he(f,a),p[0]&32&&r!==(r="blurry-bg "+h[30].gender+"-entry flex pointer-events-none px-1 w-full items-center text-center text-sm font-bold svelte-wlg48u")&&d(e,"class",r)},i:fe,o:fe,d(h){h&&N(e)}}}function kt(n){let e,t,s;const o=[n[30].props];var l=n[30].component;function i(a){let f={};for(let u=0;u<o.length;u+=1)f=tt(f,o[u]);return{props:f}}return l&&(e=Ee(l,i())),{c(){e&&De(e.$$.fragment),t=Je()},m(a,f){e&&He(e,a,f),C(a,t,f),s=!0},p(a,f){const u=f[0]&32?$e(o,[et(a[30].props)]):{};if(f[0]&32&&l!==(l=a[30].component)){if(e){me();const r=e;ee(r.$$.fragment,1,0,()=>{Re(r,1)}),pe()}l?(e=Ee(l,i()),De(e.$$.fragment),W(e.$$.fragment,1),He(e,t.parentNode,t)):e=null}else l&&e.$set(u)},i(a){s||(e&&W(e.$$.fragment,a),s=!0)},o(a){e&&ee(e.$$.fragment,a),s=!1},d(a){a&&N(t),e&&Re(e,a)}}}function Ve(n){let e,t,s,o;const l=[kt,wt],i=[];function a(f,u){return f[30].isSvelteComponent?0:1}return e=a(n),t=i[e]=l[e](n),{c(){t.c(),s=Je()},m(f,u){i[e].m(f,u),C(f,s,u),o=!0},p(f,u){let r=e;e=a(f),e===r?i[e].p(f,u):(me(),ee(i[r],1,1,()=>{i[r]=null}),pe(),t=i[e],t?t.p(f,u):(t=i[e]=l[e](f),t.c()),W(t,1),t.m(s.parentNode,s))},i(f){o||(W(t),o=!0)},o(f){ee(t),o=!1},d(f){i[e].d(f),f&&N(s)}}}function yt(n){let e,t,s,o,l,i,a=n[5],f=[];for(let r=0;r<a.length;r+=1)f[r]=Ve(Ke(n,a,r));const u=r=>ee(f[r],1,1,()=>{f[r]=null});return{c(){e=b("div"),t=b("div");for(let r=0;r<f.length;r+=1)f[r].c();o=D(),l=b("div"),d(t,"id","hover-content"),d(t,"class"," svelte-wlg48u"),d(e,"id","hover"),d(e,"class",s="select-none absolute truncate text-white rounded z-[9999] "+(n[4].useMotion.value?"use-motion":"")+" svelte-wlg48u"),le(e,"--UIScale",n[4].UIScale.value),le(e,"pointer-events",n[2]?"all":"none"),d(l,"id","static-hover"),d(l,"class","absolute left-0 top-0 z-[99999] svelte-wlg48u")},m(r,h){C(r,e,h),g(e,t);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(t,null);n[9](t),n[10](e),C(r,o,h),C(r,l,h),n[11](l),i=!0},p(r,h){if(h[0]&32){a=r[5];let p;for(p=0;p<a.length;p+=1){const H=Ke(r,a,p);f[p]?(f[p].p(H,h),W(f[p],1)):(f[p]=Ve(H),f[p].c(),W(f[p],1),f[p].m(t,null))}for(me(),p=a.length;p<f.length;p+=1)u(p);pe()}(!i||h[0]&16&&s!==(s="select-none absolute truncate text-white rounded z-[9999] "+(r[4].useMotion.value?"use-motion":"")+" svelte-wlg48u"))&&d(e,"class",s),(!i||h[0]&16)&&le(e,"--UIScale",r[4].UIScale.value),(!i||h[0]&4)&&le(e,"pointer-events",r[2]?"all":"none")},i(r){if(!i){for(let h=0;h<a.length;h+=1)W(f[h]);i=!0}},o(r){f=f.filter(Boolean);for(let h=0;h<f.length;h+=1)ee(f[h]);i=!1},d(r){r&&N(e),ve(f,r),n[9](null),n[10](null),r&&N(o),r&&N(l),n[11](null)}}}function St(n,e,t){let{rootNode:s}=e,{shadowRootNode:o}=e,{parentDocument:l=document}=e,i=!1,a,f,u=0,r=0,h=0,p=0,H=!1,T,M,y=Ie;nt.get("options").then(v=>{t(4,y=v.options||Ie)});let B=[];je(()=>{S()});function X(){t(0,a.style.left=u+"px",a),t(0,a.style.top=r+"px",a),window.requestAnimationFrame(X)}function S(){lt(),chrome.runtime.sendMessage({type:"isExtensionOn"},v=>{console.log(we,": checking: isExtensionOn?",v.isExtensionOn),v.isExtensionOn&&!i&&w()}),setTimeout(()=>{X()},50)}chrome.runtime.onMessage.addListener(function(v,R,j){switch(v.type){case"enableExtension":i||w();break;case"disableExtension":K();break;case"updateOptions":t(4,y=v.data);break}});function w(){i=!0,l.addEventListener("mousemove",G),l.addEventListener("selectionchange",x),l.addEventListener("keydown",oe),l.body.appendChild(s)}function K(){i=!1,l.removeEventListener("mousemove",G),l.removeEventListener("selectionchange",x),l.removeEventListener("keydown",oe);let v=l.getElementById(`${we}-root`);v&&v.remove()}function A(v){t(5,B=v),t(0,a.style.opacity=1,a)}function k(){H||(T="",t(0,a.style.opacity=0,a))}function x(v){let R=l.getSelection();if(R.isCollapsed)t(2,H=!1),k();else{let j=R.getRangeAt(0),O=R.getRangeAt(0).toString().trim(),U=j.getBoundingClientRect();t(2,H=!0),u=U.x+U.width/2-a.offsetWidth/2,r=U.y+l.documentElement.scrollTop-(a.offsetHeight+y.distanceToMouse.value)*y.UIScale.value,A([{isSvelteComponent:!0,component:_t,props:{staticHoverNode:M,parentDocument:l,selectionText:O,hideToolbar:()=>{t(2,H=!1),k()},options:y}}])}}function G(v){if(h=v.pageX,p=v.pageY,!a||H)return;let R;if(l.caretRangeFromPoint?R=l.caretRangeFromPoint(v.clientX,v.clientY):v.rangeParent&&(R=l.createRange(),R.setStart(v.rangeParent,v.rangeOffset)),console.log("range",R),!R)return;const O=R.startContainer.nodeValue;if(!O)k();else{const U=R.startOffset,se=O.slice(0,U),ie=O.slice(U);if(se&&ie){const z=se.search(/[^\p{L}\p{M}0-9-](?![\s\S]*[^\p{L}\p{M}0-9-])/u),I=ie.search(/[^\p{L}\p{M}0-9-]/u),$=z===-1?0:z+1,P=I===-1?O.length:U+I,E=O.slice($,P).toLowerCase();if(E!==T){if(!E)return;T=E,chrome.runtime.sendMessage({word:E,type:"getGender"},J=>{J.data.length>0?A(J.data):k()})}}}ae(v)}function oe(v){v.stopImmediatePropagation(),document.activeElement.tagName!=="INPUT"&&(v.key==="a"||v.key==="A")&&v.altKey&&!v.metaKey&&!v.shiftKey&&new Qe({target:M,props:{parentDocument:l,staticHoverNode:M,initialX:h-(y.shouldPopupBePinned.value?document.documentElement.scrollLeft||document.body.scrollLeft:0),initialY:p-(y.shouldPopupBePinned.value?document.documentElement.scrollTop||document.body.scrollTop:0),options:y,contentToSave:""}})}function ae(v){H||(u=Math.min(window.innerWidth-a.offsetWidth*y.UIScale.value-10,v.pageX+y.distanceToMouse.value*y.UIScale.value),r=Math.max(v.pageY-a.offsetHeight-y.distanceToMouse.value*y.UIScale.value,10))}console.log("LOADED OPTIONS",y);function te(v){de[v?"unshift":"push"](()=>{f=v,t(1,f)})}function ue(v){de[v?"unshift":"push"](()=>{a=v,t(0,a)})}function V(v){de[v?"unshift":"push"](()=>{M=v,t(3,M)})}return n.$$set=v=>{"rootNode"in v&&t(6,s=v.rootNode),"shadowRootNode"in v&&t(7,o=v.shadowRootNode),"parentDocument"in v&&t(8,l=v.parentDocument)},[a,f,H,M,y,B,s,o,l,te,ue,V]}class Ct extends Le{constructor(e){super(),Ce(this,e,St,yt,Ne,{rootNode:6,shadowRootNode:7,parentDocument:8},null,[-1,-1])}}export{Ct as default};
//# sourceMappingURL=Content.js.map
